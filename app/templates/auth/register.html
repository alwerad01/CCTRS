{% extends "base.html" %}

{% block title %}Register - Civic Portal{% endblock %}

{% block content %}
<div class="row justify-content-center align-items-center min-vh-75 mt-4">
    <div class="col-lg-10 col-xl-9">
        <div class="card shadow-lg border-0 rounded-4 overflow-hidden">
            <div class="row g-0">

                <!-- Left Branding Panel (Hidden on small screens) -->
                <div class="col-md-5 d-none d-md-flex flex-column justify-content-between p-5 text-white"
                    style="background: linear-gradient(135deg, #0dcaf0 0%, #0d6efd 100%); position: relative;">
                    <!-- Subtle background pattern overlay -->
                    <div
                        style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; opacity: 0.1; background-image: radial-gradient(#fff 1px, transparent 1px); background-size: 20px 20px; z-index: 0;">
                    </div>

                    <div class="position-relative z-1">
                        <i class="bi bi-people-fill display-4 mb-3 d-inline-block text-white"></i>
                        <h2 class="fw-bold display-6 mb-3">Join the Community</h2>
                        <p class="lead opacity-75 fs-6">Register to submit complaints, track issues, and help improve
                            your city.</p>
                    </div>

                    <div class="position-relative z-1 small opacity-50">
                        &copy; 2026 CCTRS Registration
                    </div>
                </div>

                <!-- Right Form Panel -->
                <div class="col-md-7">
                    <div class="card-body p-sm-5 p-4">

                        <!-- Mobile Header -->
                        <div class="text-center mb-4 d-md-none">
                            <i class="bi bi-people-fill display-4 text-info mb-2"></i>
                            <h3 class="fw-bold">Join Us</h3>
                            <p class="text-muted small">Create an account to get started</p>
                        </div>

                        <!-- Desktop Header -->
                        <div class="mb-5 d-none d-md-block">
                            <h3 class="fw-bold mb-1">Create an Account</h3>
                            <p class="text-muted">Fill in your details below to register.</p>
                        </div>

                        <form method="POST" action="{{ url_for('auth.register') }}" id="registerForm">

                            <!-- Username Input -->
                            <div class="mb-4">
                                <label for="username" class="form-label fw-semibold text-secondary small text-uppercase"
                                    style="letter-spacing: 0.5px;">Username</label>
                                <div class="input-group input-group-lg shadow-sm rounded-3">
                                    <span class="input-group-text bg-light border-end-0 text-muted px-3"><i
                                            class="bi bi-person"></i></span>
                                    <input type="text" class="form-control bg-light border-start-0 ps-0" id="username"
                                        name="username" placeholder="Choose a username" minlength="3" required
                                        autofocus>
                                </div>
                                <div class="form-text small mt-1">At least 3 characters</div>
                            </div>

                            <!-- Email Input -->
                            <div class="mb-4">
                                <label for="email" class="form-label fw-semibold text-secondary small text-uppercase"
                                    style="letter-spacing: 0.5px;">Email Address</label>
                                <div class="input-group input-group-lg shadow-sm rounded-3">
                                    <span class="input-group-text bg-light border-end-0 text-muted px-3"><i
                                            class="bi bi-envelope"></i></span>
                                    <input type="email" class="form-control bg-light border-start-0 ps-0" id="email"
                                        name="email" placeholder="name@example.com" required>
                                </div>
                            </div>

                            <div class="row">
                                <!-- Password Input -->
                                <div class="col-md-6 mb-4">
                                    <label for="password"
                                        class="form-label fw-semibold text-secondary small text-uppercase"
                                        style="letter-spacing: 0.5px;">Password</label>
                                    <div class="input-group shadow-sm rounded-3">
                                        <span class="input-group-text bg-light border-end-0 text-muted"><i
                                                class="bi bi-lock"></i></span>
                                        <input type="password"
                                            class="form-control bg-light border-start-0 border-end-0 ps-0" id="password"
                                            name="password" placeholder="Min 6 chars" minlength="6" required>
                                        <button class="btn btn-light border border-start-0 text-muted toggle-password"
                                            type="button" data-target="password">
                                            <i class="bi bi-eye-slash"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- Confirm Password Input -->
                                <div class="col-md-6 mb-4">
                                    <label for="confirm_password"
                                        class="form-label fw-semibold text-secondary small text-uppercase"
                                        style="letter-spacing: 0.5px;">Confirm Password</label>
                                    <div class="input-group shadow-sm rounded-3">
                                        <span class="input-group-text bg-light border-end-0 text-muted"><i
                                                class="bi bi-shield-lock"></i></span>
                                        <input type="password"
                                            class="form-control bg-light border-start-0 border-end-0 ps-0"
                                            id="confirm_password" name="confirm_password" placeholder="Confirm"
                                            required>
                                        <button class="btn btn-light border border-start-0 text-muted toggle-password"
                                            type="button" data-target="confirm_password">
                                            <i class="bi bi-eye-slash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Submit Button -->
                            <button type="submit" class="btn btn-primary btn-lg w-100 shadow-sm fw-bold mt-2 rounded-3">
                                Register Account <i class="bi bi-person-plus ms-2"></i>
                            </button>
                        </form>

                        <div class="text-center mt-5 pt-3 border-top">
                            <p class="text-muted mb-1 small">Already have an account?</p>
                            <a href="{{ url_for('auth.login') }}" class="text-decoration-none fw-bold">Sign In Here</a>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Client-side password confirmation validation
    document.getElementById('registerForm').addEventListener('submit', function (e) {
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirm_password').value;

        if (password !== confirmPassword) {
            e.preventDefault();
            alert('Passwords do not match!');
            document.getElementById('confirm_password').focus();
        }
    });

    // Password visibility toggle logic
    document.addEventListener("DOMContentLoaded", function () {
        const toggleButtons = document.querySelectorAll('.toggle-password');

        toggleButtons.forEach(button => {
            button.addEventListener('click', function () {
                const targetId = this.getAttribute('data-target');
                const passwordInput = document.getElementById(targetId);
                const icon = this.querySelector('i');

                if (passwordInput && icon) {
                    const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                    passwordInput.setAttribute('type', type);

                    if (type === 'password') {
                        icon.classList.remove('bi-eye');
                        icon.classList.add('bi-eye-slash');
                    } else {
                        icon.classList.remove('bi-eye-slash');
                        icon.classList.add('bi-eye');
                    }
                }
            });
        });
    });
</script>
{% endblock %}