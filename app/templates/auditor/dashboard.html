{% extends "base.html" %}
{% block title %}Audit View — All Complaints{% endblock %}
{% block content %}
<h2 class="mb-4"><i class="bi bi-journal-text"></i> Audit View
    <small class="text-muted fs-6">— Read-Only Access</small>
    <span class="badge bg-secondary ms-2">{{ complaints|length }} results</span>
</h2>

<!-- Status Quick Filter -->
<div class="card shadow-sm mb-4">
    <div class="card-body d-flex flex-wrap gap-2">
        <a href="{{ url_for('auditor.dashboard') }}"
            class="btn btn-sm {% if status_filter == 'all' %}btn-dark{% else %}btn-outline-dark{% endif %}">
            All ({{ status_counts.values()|sum }})
        </a>
        {% for s in valid_statuses if s != 'Draft' %}
        <a href="{{ url_for('auditor.dashboard', status=s) }}"
            class="btn btn-sm {% if status_filter == s %}btn-primary{% else %}btn-outline-secondary{% endif %}">
            {{ s }} ({{ status_counts[s] }})
        </a>
        {% endfor %}
    </div>
</div>

<!-- Complaints Table -->
<div class="card shadow-sm">
    <div class="card-body">
        {% if complaints %}
        <div class="table-responsive">
            <table class="table table-hover">
                <thead class="table-light">
                    <tr>
                        <th>ID</th>
                        <th>Title</th>
                        <th>Department</th>
                        <th>Citizen</th>
                        <th>Officer</th>
                        <th>Status</th>
                        <th>Created</th>
                        <th>Last Updated</th>
                        <th>Detail</th>
                    </tr>
                </thead>
                <tbody>
                    {% for c in complaints %}
                    <tr>
                        <td><strong>#{{ c.id }}</strong></td>
                        <td>{{ c.title }}</td>
                        <td><span class="badge bg-secondary">{{ c.department.name }}</span></td>
                        <td>{{ c.citizen.username }}</td>
                        <td>{{ c.assigned_officer.username if c.assigned_officer else '—' }}</td>
                        <td>
                            <span class="badge status-{{ c.current_status|replace(' ', '-')|lower }}">
                                {{ c.current_status }}
                            </span>
                        </td>
                        <td>{{ c.created_at.strftime('%Y-%m-%d') }}</td>
                        <td>{{ c.updated_at.strftime('%Y-%m-%d') }}</td>
                        <td>
                            <a href="{{ url_for('auditor.complaint_detail', complaint_id=c.id) }}"
                                class="btn btn-sm btn-outline-secondary">
                                <i class="bi bi-eye"></i>
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-center py-5 text-muted">
            <i class="bi bi-search" style="font-size:3rem;"></i>
            <h5 class="mt-3">No complaints found for this filter.</h5>
        </div>
        {% endif %}
    </div>
</div>

<!-- Status Distribution Summary -->
<div class="card shadow-sm mt-4">
    <div class="card-header bg-light">
        <h5 class="mb-0">Status Distribution</h5>
    </div>
    <div class="card-body">
        <div class="row g-2">
            {% for s, count in status_counts.items() %}
            {% if count > 0 %}
            <div class="col-6 col-md-3 col-lg-2">
                <div class="text-center p-2 border rounded">
                    <span class="badge status-{{ s|replace(' ', '-')|lower }} d-block mb-1">{{ s }}</span>
                    <strong>{{ count }}</strong>
                </div>
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}